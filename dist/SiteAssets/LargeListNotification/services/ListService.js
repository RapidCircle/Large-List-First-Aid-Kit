define(["jquery"],function(e){function t(e){var t=jQuery.Deferred();return jQuery.ajax({url:_spPageContextInfo.siteAbsoluteUrl+"/_api/web/lists('"+e.ListId+"')/views?"+e.OData,type:"GET",headers:{accept:"application/json;odata=verbose"}}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}function o(e){var t=jQuery.Deferred();return i().then(function(){jQuery.ajax({url:_spPageContextInfo.siteAbsoluteUrl+"/_api/web/lists('"+e.ListId+"')/views",method:"POST",data:e.bodyContent,headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":s.requestDigest.FormDigestValue}}).done(function(e){console.log("View Created",e),t.resolve(e)}).fail(function(e){t.reject(e)})}),t.promise()}function r(e){var t=jQuery.Deferred();return jQuery.ajax({url:_spPageContextInfo.siteAbsoluteUrl+"/_api/web/lists('"+e.ListId+"')/fields?$filter=Indexed eq true&"+e.OData,type:"GET",headers:{accept:"application/json;odata=verbose"}}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}function n(e){var t=jQuery.Deferred();return jQuery.ajax({url:_spPageContextInfo.siteAbsoluteUrl+"/_api/web/lists('"+e.ListId+"')?"+e.OData,type:"GET",headers:{accept:"application/json;odata=verbose"}}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}var s=this;this.requestDigest=null;var i=function(){var t=e.Deferred();return s.requestDigest&&s.requestDigest.expiresOn>new Date?t.resolve():(e.ajax({type:"POST",url:_spPageContextInfo.siteAbsoluteUrl+"/_api/contextinfo",headers:{accept:"application/json;odata=verbose"}}).done(function(e){var o=(new Date).getTime();s.requestDigest=e.d.GetContextWebInformation,s.requestDigest.expiresOn=o+1e3*e.d.GetContextWebInformation.FormDigestTimeoutSeconds-6e4,console.log("Token",s.requestDigest.FormDigestValue),t.resolve()}).fail(function(e){console.log("Error fetching Request Digest. Some parts won't work."),t.reject()}),t.promise())};return{GetView:t,GetIndexedColumns:r,GetList:n,AddView:o}});