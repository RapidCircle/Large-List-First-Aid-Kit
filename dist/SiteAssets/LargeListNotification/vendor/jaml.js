define([],function(){return Jaml=function(){return{templates:{},register:function(t,e){this.templates[t]=e},render:function(t,e,n){var i=this.templates[t],r=new Jaml.Template(i);return r.render.apply(r,Array.prototype.slice.call(arguments,1))}}}(),Jaml.Node=function(t){this.tagName=t,this.attributes={},this.children=[]},Jaml.Node.prototype={setAttributes:function(t){for(var e in t){var n="cls"==e?"class":e;this.attributes[n]=t[e]}return this},addChild:function(t){return this.children.push(t),this},render:function(t){t=t||0;var e=[],n=[],i=this instanceof Jaml.TextNode,r=this.multiLineTag();i||e.push(this.getPadding(t)),e.push("<"+this.tagName);for(var a in this.attributes)n.push(a+'="'+this.attributes[a]+'"');n.sort();for(var o=0;o<n.length;o++)e.push(" "+n[o]);return this.isSelfClosing()&&0==this.children.length?e.push("/>\n"):(e.push(">"),r&&e.push("\n"),this.renderChildren(e,this.children,t),r&&e.push(this.getPadding(t)),e.push("</",this.tagName,">\n")),e.join("")},renderChildren:function(t,e,n){for(var i=n+2,r=0;r<e.length;r++){var a=e[r];if(a instanceof Array){var o=a;this.renderChildren(t,o,n)}else t.push(a.render(i))}},multiLineTag:function(){var t=this.children.length,e=t>0;return 1==t&&this.children[0]instanceof Jaml.TextNode&&(e=!1),e},getPadding:function(t){return new Array(t+1).join(" ")},isSelfClosing:function(){for(var t=this.notSelfClosingTags.length-1;t>=0;t--)if(this.tagName==this.notSelfClosingTags[t])return!1;return!0},notSelfClosingTags:["textarea","script","em","strong","option","select"]},Jaml.TextNode=function(t){this.text=t},Jaml.TextNode.prototype={render:function(){return this.text}},Jaml.Template=function(t){this.tpl=t,this.nodes=[]},Jaml.Template.prototype={render:function(thisObj,data){with(data=data||(thisObj=thisObj||{}),data.constructor.toString().indexOf("Array")==-1&&(data=[data]),this)for(var i=0;i<data.length;i++)eval("("+this.tpl.toString()+").call(thisObj, data[i], i)");for(var roots=this.getRoots(),output="",i=0;i<roots.length;i++)output+=roots[i].render();return output},getRoots:function(){for(var t=[],e=0;e<this.nodes.length;e++){var n=this.nodes[e];void 0==n.parent&&t.push(n)}return t},tags:["html","head","body","script","meta","title","link","div","p","span","a","img","br","hr","em","i","strong","b","table","tr","th","td","thead","tbody","tfoot","ul","ol","li","dl","dt","dd","h1","h2","h3","h4","h5","h6","h7","form","fieldset","input","textarea","label","select","option"]},function(){for(var t,e=Jaml.Template.prototype.tags,n=function(t){return function(e){var n=new Jaml.Node(t),i=!("object"!=typeof e||e instanceof Jaml.Node||e instanceof Jaml.TextNode);i&&n.setAttributes(e);for(var r=i?1:0,a=r;a<arguments.length;a++){var o=arguments[a];"string"!=typeof o&&void 0!=o||(o=new Jaml.TextNode(o||"")),(o instanceof Jaml.Node||o instanceof Jaml.TextNode)&&(o.parent=n),n.addChild(o)}return this.nodes.push(n),n}},i=0;t=e[i];i++)Jaml.Template.prototype[t]=n(t)}(),Jaml});